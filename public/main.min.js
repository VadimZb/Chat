"use strict";var socket=io(),$messages=document.querySelector("#messages"),$inputField=document.querySelector("#inputField"),$username=document.querySelector("#username"),$online=document.querySelector("#online");function generateMessage(e,t,n){function a(e){var t=document.createElement("span");t.classList.add("big");return new RegExp(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/).test(e)?t.appendChild(function(e){var t=document.createElement("a");return t.setAttribute("href",e),t.setAttribute("target","_blank"),t.classList.add("a","bold"),t.textContent=e,t}(e)):t.textContent=e,t}function s(e){var t=document.createElement("i");if("io"===e)t.classList.add("fas","fa-user");else if("socket"===e)t.classList.add("far","fa-user");else{if("system"!==e)throw Error("Wrong type provided");t.classList.add("far","fa-bell")}return t}function r(e,t){var n=document.createElement("div");return"text"===t?(n.classList.add("padding","border-top"),"socket"===e?n.classList.add("lightest-green-bg"):n.classList.add("lightest-bg")):"info"===t&&n.classList.add("margin-horizontal","margin-vertical"),n}return"system"===e?function(e,t){var n=document.createElement("span");n.classList.add("gray","space-left","nocopy"),n.textContent=e+" "+t;var a=s("system"),r=document.createElement("li");r.classList.add("margin-vertical","margin-horizontal","padding","align-center","animated");for(var i=[a,n],l=0;l<i.length;l++){var d=i[l];r.appendChild(d)}return r}(t,n):function(e,t,n){for(var i=document.createElement("li"),l=s(e),d=function(e){var t=document.createElement("span");return t.classList.add("bold","big","space-left"),t.textContent=e,t}(t),o=a(n),c=function(){var e=document.createElement("span"),t=new Date,n=t.getHours(),a=t.getMinutes();n<10&&(n="0"+n),a<10&&(a="0"+a);var s=n+":"+a;return e.textContent=s,e.classList.add("gray","small","space-left","nocopy"),e}(),u=r(e,"info"),m=r(e,"text"),g=[l,d,c],f=0;f<g.length;f++){var p=g[f];u.appendChild(p)}m.appendChild(o);for(var v=[u,m],h=0;h<v.length;h++){var $=v[h];i.appendChild($)}return i.classList.add("margin-vertical","margin-horizontal","border","animated"),"io"===e?i.classList.add("light-bg"):i.classList.add("light-green-bg"),i}(e,t,n)}function enterChat(){if($username.value.replace(/\s/g,"").length)if($username.value.length>20)alert("Username should less than 20 characters."),$username.focus();else{var e=document.getElementById("name"),t=document.getElementById("chat");document.getElementById("header");document.getElementById("info").textContent=$username.value,socket.emit("name given",$username.value),e.style.display="none",t.style.display="flex"}else $username.value="",$username.focus()}function addMessage(e){$messages.appendChild(e),$messages.scrollTop=$messages.scrollHeight}function sendMessage(){$inputField.value.replace(/\s/g,"").length?(addMessage(generateMessage("socket",$username.value,$inputField.value)),socket.emit("message sent",$username.value,$inputField.value),$inputField.value=""):$inputField.value="";$inputField.focus()}window.addEventListener("keypress",(function(e){"Enter"===e.key&&sendMessage()})),socket.on("user joined",(function(e){addMessage(generateMessage("system",e,"joined"))})),socket.on("user left",(function(e){addMessage(generateMessage("system",e,"left"))})),socket.on("new message",(function(e,t){addMessage(generateMessage("io",e,t))})),socket.on("refresh online",(function(e){$online.textContent=e}));
