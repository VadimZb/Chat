"use strict";var socket=io(),$messages=document.querySelector("#messages"),$inputField=document.querySelector("#inputField"),$username=document.querySelector("#username"),$online=document.querySelector("#online");window.addEventListener("keypress",(function(e){"Enter"===e.key&&sendMessage()}));var lastUser="";function generateMessage(e,t,s){function a(e){var t=document.createElement("span");t.classList.add("big");return new RegExp(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/).test(e)?t.appendChild(function(e){var t=document.createElement("a");return t.setAttribute("href",e),t.setAttribute("target","_blank"),t.classList.add("a","bold"),t.textContent=e,t}(e)):t.textContent=e,t}function n(e){var t=document.createElement("i");if("io"===e)t.classList.add("fas","fa-user");else if("socket"===e)t.classList.add("far","fa-user");else{if("system"!==e)throw Error("Wrong type provided");t.classList.add("far","fa-bell")}return t}function r(e,t,s){var a=document.createElement("div");return"text"===t?(a.classList.add("padding"),s&&a.classList.add("border-top"),"socket"===e?a.classList.add("lightest-green-bg"):a.classList.add("lightest-bg")):"info"===t&&a.classList.add("margin-horizontal","margin-vertical"),a}return"system"===e?function(e,t){var s=document.createElement("span");s.classList.add("gray","space-left","nocopy"),s.textContent=e+" "+t;var a=n("system"),r=document.createElement("li");r.classList.add("margin-vertical","margin-horizontal","padding","align-center","animated");for(var l=[a,s],i=0;i<l.length;i++){var d=l[i];r.appendChild(d)}return r}(t,s):function(e,t,s){var l=document.createElement("li");if(t===lastUser){var i=a(s),d=r(e,"text");d.appendChild(i),l.appendChild(d),l.classList.add("margin-vertical","margin-horizontal","border","animated"),"io"===e?l.classList.add("lightest-bg"):l.classList.add("lightest-green-bg")}else{for(var o=n(e),c=function(e){var t=document.createElement("span");return t.classList.add("bold","big","space-left"),t.textContent=e,t}(t),u=a(s),g=function(){var e=document.createElement("span"),t=new Date,s=t.getHours(),a=t.getMinutes();s<10&&(s="0"+s),a<10&&(a="0"+a);var n=s+":"+a;return e.textContent=n,e.classList.add("gray","small","space-left","nocopy"),e}(),m=r(e,"info"),f=r(e,"text"),p=[o,c,g],v=0;v<p.length;v++){var h=p[v];m.appendChild(h)}f.appendChild(u);for(var y=[m,f],$=0;$<y.length;$++){var L=y[$];l.appendChild(L)}l.classList.add("margin-vertical","margin-horizontal","border","animated"),"io"===e?l.classList.add("light-bg"):l.classList.add("light-green-bg")}return lastUser=t,l}(e,t,s)}function enterChat(){if($username.value.replace(/\s/g,"").length)if($username.value.length>20)alert("Username should less than 20 characters."),$username.focus();else if(usersArray.includes($username.value))alert("Username is taken"),$username.focus();else{var e=document.getElementById("name"),t=document.getElementById("chat");document.getElementById("header");document.getElementById("info").textContent=$username.value,socket.emit("name given",$username.value),e.style.display="none",t.style.display="flex",console.log(usersArray),console.log($username.value)}else $username.value="",$username.focus()}function addMessage(e){$messages.appendChild(e),$messages.scrollTop=$messages.scrollHeight}function sendMessage(){$inputField.value.replace(/\s/g,"").length?(addMessage(generateMessage("socket",$username.value,$inputField.value)),socket.emit("message sent",$username.value,$inputField.value),$inputField.value=""):$inputField.value="";$inputField.focus()}socket.on("user joined",(function(e){addMessage(generateMessage("system",e,"joined"))})),socket.on("user left",(function(e){addMessage(generateMessage("system",e,"left"))})),socket.on("new message",(function(e,t){addMessage(generateMessage("io",e,t))})),socket.on("refresh online",(function(e){$online.textContent=e}));var usersArray=[];socket.on("send blacklist",(function(e){console.log(e),usersArray=e}));
